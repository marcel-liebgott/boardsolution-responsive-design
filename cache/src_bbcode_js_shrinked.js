        var bsMarkedTags =new Array(); var popups=new Array(); var tagAdded =new Array(); var cp=new Array();  function showPopup(number,tag) {var id ='tag_'+tag +'_'+number +'_popup';	if(tagAdded[tag +number]) {_insertAtCursor('bbcode_area' +number,"[/" +tag +"]");unmarkItem('tag_' +tag +'_'+number); tagAdded[tag +number] =0;popups[tag +number] =0;}else if(popups[tag +number]) {	if(tag =='color')cp[number].hide(); else FWS_hideElement(id); popups[tag +number] =0;}else {    	if(navigator.vendor &&navigator.vendor.indexOf('KDE') !=-1&&typeof popups[tag] =='undefined'){var body=document.getElementsByTagName('body')[0]; var el =FWS_getElement(id); 	if(el !=null) {var btn =FWS_getElement('tag_' +tag +'_'+number); el.parentNode.removeChild(el); el.style.position ='absolute';el.style.display ='block';el.style.left =(btn.offsetLeft +body.offsetLeft -el.offsetWidth) +'px';body.appendChild(el); }}	if(tag =='color')cp[number].toggle('tag_' +tag +'_'+number,'brl'); else FWS_displayElement(id,'tag_' +tag +'_'+number,'brl'); popups[tag +number] =1;}} function popupElementClick(number,tag,param) {FWS_hideElement('tag_' +tag +'_'+number +'_popup');FWS_getElement('bbcode_area' +number).focus(); var tagimg =FWS_getElement('tag_' +tag +'_'+number); var text =param !=''?'['+tag +'='+param +']':'['+tag +']';	insertBBCode(number,'bbcode_area' +number,text,tag,tagimg); tagAdded[tag +number] = isItemMarked('tag_' +tag +'_'+number); 	if(!tagAdded[tag +number]) popups[tag +number] =0;} function changeBBCodeMode(number,mode,form) {	if(BBCodeModes[number] !='applet'&&mode =='applet')form.getPostForm(mode); else if(BBCodeModes[number] =='applet'&&mode !='applet')form.getPostForm(mode); BBCodeModes[number] =mode; }      function hoverItem(number,id,hoverText) {var item =document.getElementById(id); 	item.style.cursor ='pointer';document.getElementById('bbc_explain_' +number).value =hoverText; 	if(item !=null && item.src &&!bsMarkedTags.contains(id)) 	item.style.borderColor ='#555555';}      function unhoverItem(number,id) {var item =document.getElementById(id); 	item.style.cursor ='default';document.getElementById('bbc_explain_' +number).value ='';	if(item !=null && item.src &&!bsMarkedTags.contains(id)) 	item.style.borderColor ='#AAAAAA';}     function isItemMarked(id) {return bsMarkedTags.contains(id); }     function markItem(id) {var item =document.getElementById(id); 	if(item !=null) {	item.style.borderColor ='#FF0000';	if(!Browser.isOpera) 	item.style.borderStyle ='dotted';bsMarkedTags.push(id); }}     function unmarkItem(id) {var item =document.getElementById(id); 	if(item !=null) {	item.style.borderColor ='#AAAAAA';	item.style.borderStyle ='solid';bsMarkedTags.removeEntry(id); }}     function insertSmiley(id,smiley) {var textarea =document.getElementById(id); 	if(smiley) {_insertAtCursor(id,smiley); textarea.focus(); }}       function insertBBCode(number,id,text,tag,object) {var textarea =document.getElementById(id); 	if(text) {	if(BBCodeModes[number] =='advanced'){	if(!_surroundMarkedText(textarea,tag,text)) {	if(object !=null) _pasteTag(id,object,tag,text); else { _insertAtCursor(id,text); var str ='[/'+tag +']';_insertAtCursor(id,str); moveCursorForward(id,-str.length); }}}else {text =text.trim(); 	if(_getSelection(id) !="")_surroundMarkedText(textarea,tag,text); else {var tagData =_getTagData(tag); 	if(tagData !=null &&tagData["prompt_text"] =="")_pasteTag(id,object,tag,text); else _showBBCodePrompt(id,text,tagData); }}textarea.focus(); }}      function closeBBCodeTags(number,id) {var textarea =document.getElementById(id); var lower_text =textarea.value.toLowerCase(); var pos;var tags =new Array(); for(var x=0;x<BBCODE.length;x++) {var openingCount =0;var closingCount =0;switch(BBCODE[x]["param"]) {case "no":openingCount =lower_text.substr_count("[" +BBCODE[x]["tag"]+"]");pos=lower_text.indexOf("[" +BBCODE[x]["tag"]+"]");break; case "optional":openingCount =lower_text.substr_count("[" +BBCODE[x]["tag"]+"]");openingCount +=lower_text.substr_count("[" +BBCODE[x]["tag"]+"=");var p1=lower_text.indexOf("[" +BBCODE[x]["tag"]+"]");var p2=lower_text.indexOf("[" +BBCODE[x]["tag"]+"=");	if(p1 >=0&&p2>=0)pos=Math.min(p1,p2); else if(p1 >=0)pos=p1;else pos=p2;break; default: openingCount =lower_text.substr_count("[" +BBCODE[x]["tag"]+"=");pos=lower_text.indexOf("[" +BBCODE[x]["tag"]+"=");break; }var closing ="[/"+BBCODE[x]["tag"]+"]";closingCount =lower_text.substr_count(closing); 	if(openingCount >closingCount) tags.push(new Array(pos,closing)); } tags.sort(_numericSort); tags.reverse(); for(var i =0;i <tags.length;i++) textarea.value +=tags[i][1]; for(var i =0;i <BBCODE.length;i++) {var object =document.getElementById("tag_" +BBCODE[i]["tag"] +"_"+number); 	if(object !=null) {	if(bsMarkedTags.contains(object.id)) unmarkItem(object.id); }}}function _getTagData(tag) {for(var i =0;i <BBCODE.length;i++) {	if(BBCODE[i]["tag"] ==tag) return BBCODE[i]; }return null; }     function _getSelection(id) {	if(typeof document.selection !='undefined')return document.selection.createRange().text; var textarea =document.getElementById(id); 	if(typeof textarea.selectionStart !='undefined')return textarea.value.substring(textarea.selectionStart,textarea.selectionEnd); return "";}       function _insertAtCursor(id,text) {var textarea =document.getElementById(id); var scroll_top =textarea.scrollTop; textarea.focus(); 	if(typeof document.selection !='undefined'){var range =document.selection.createRange(); range.text =text; }else if(typeof textarea.selectionStart !='undefined'){var start =textarea.selectionStart; var end =textarea.selectionEnd; var content =textarea.value; textarea.value =content.substring(0,start); textarea.value +=text; textarea.value +=content.substring(end,content.length); }else {textarea.value +=text; }textarea.scrollTop =scroll_top; }    function moveCursorForward(id,count) {var textarea =document.getElementById(id); 	if(typeof document.selection !='undefined'&&Browser.isOpera) range.move('character',count); else if(typeof textarea.selectionStart !='undefined'){var pos=textarea.selectionStart +count; textarea.selectionStart =pos;textarea.selectionEnd =pos;}}  function _surroundMarkedText(textarea,tag,startTag) {startTag =startTag.trim(); var scroll_top =textarea.scrollTop; var EndTag ="[/"+tag +"]";	if(EndTag =="")return false; 	if(document.selection) {textarea.focus(); var selection =document.selection.createRange().text; 	if(selection !=""){var range =document.selection.createRange(); range.text =startTag +selection +EndTag; range.move('character',range.text); range.select(); textarea.scrollTop =scroll_top; return true; }textarea.scrollTop =scroll_top; return false; }var content =textarea.value; 	if(textarea.selectionEnd !=textarea.selectionStart) {var SelStart =textarea.selectionStart; var SelEnd =textarea.selectionEnd; textarea.value =content.substring(0,SelStart); textarea.value +=startTag +content.substring(SelStart,SelEnd) +EndTag; textarea.value +=content.substring(SelEnd,content.length); textarea.scrollTop =scroll_top; return true; }textarea.scrollTop =scroll_top; return false; }        function _pasteTag(id,object,tag,text) {	if(object ==null) _insertAtCursor(id,text); else {	if(bsMarkedTags.contains(object.id)) {_insertAtCursor(id,"[/" +tag +"]");unmarkItem(object.id); }else {_insertAtCursor(id,text); markItem(object.id); }}}   function _showBBCodePrompt(id,startTag,tagData) {var textarea =document.getElementById(id); 	if(tagData["prompt_param_text"] !=""){var param =prompt(tagData["prompt_param_text"],""); 	if(param !=null &&param !=""){var text =prompt(tagData["prompt_text"],""); 	if(text !=null) _insertAtCursor(id,"[" +tagData["tag"] +"="+param +"]"+text +"[/"+tagData["tag"] +"]");}}else {var text =prompt(tagData["prompt_text"],""); 	if(text !=null) _insertAtCursor(id,startTag +text +"[/"+tagData["tag"] +"]");}}     function _numericSort(a,b) {return a[0]-b[0];}